<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BabyBeat ‚Ä¢ Fetal Heartbeat Monitor</title>

  <style>
    :root{
      --bg-1: #0c1023;
      --bg-2: #12173a;
      --card: rgba(255,255,255,.06);
      --card-2: rgba(255,255,255,.10);
      --stroke: rgba(255,255,255,.12);
      --text: #f5f7ff;
      --muted: #b9c0ffcc;
      --brand-1: #79a1ff;
      --brand-2: #9b79ff;
      --accent: #ffb357;
      --danger: #ff6b6b;
      --ok: #5eead4;
      --shadow: 0 20px 50px rgba(2,6,23,.45);
      --radius-xl: 20px;
      --radius-lg: 16px;
      --radius-md: 12px;
      --ring: 0 0 0 3px rgba(121,161,255,.3);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 15% -10%, #2a3cff30 0%, transparent 60%),
        radial-gradient(900px 700px at 95% 10%, #9b79ff22 0%, transparent 70%),
        linear-gradient(160deg, var(--bg-1) 0%, var(--bg-2) 100%);
      overflow-x:hidden;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    .wrap{max-width:1100px;margin:28px auto;padding:0 18px}
    .header{
      display:flex;align-items:center;gap:14px;margin-bottom:16px
    }
    .app-icon{
      width:44px;height:44px;display:grid;place-items:center;border-radius:12px;
      background: radial-gradient(circle at 30% 25%, #ff79b0 10%, #ff66a1 40%, #b65cff 100%);
      box-shadow: 0 10px 25px #ff66a155 inset, 0 6px 18px #965bff66;
      font-size:20px
    }
    .title{
      font-weight:800;line-height:1.05;margin:0;
      font-size:clamp(26px, 3.2vw, 40px);
      background:linear-gradient(90deg,#79a1ff 0%,#9b79ff 50%,#ffb357 100%);
      -webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent
    }
    .subtitle{
      margin:4px 0 18px 58px;color:var(--muted);font-size:14.5px
    }

    .tabs{
      background:linear-gradient(180deg, rgba(255,255,255,.09), rgba(255,255,255,.06));
      backdrop-filter: blur(16px);
      border:1px solid var(--stroke);
      border-radius: 999px;
      padding:6px;
      display:flex;gap:6px;max-width:720px
    }
    .tab{
      flex:1;border:0;cursor:pointer;padding:12px 16px;color:#cfe0ffcc;
      border-radius:999px;background:transparent;font-weight:700;letter-spacing:.2px
    }
    .tab[aria-selected="true"]{
      color:#0f132f; background:linear-gradient(90deg,#79a1ff,#9b79ff);
      box-shadow: 0 6px 20px rgba(123, 104, 238, .45)
    }

    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.09), rgba(255,255,255,.06));
      border: 1px solid var(--stroke);
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow);
      padding:18px
    }
    .stack{display:flex;flex-direction:column;gap:14px}
    .grid-3{
      display:grid;gap:14px;
      grid-template-columns: repeat(3, minmax(0,1fr));
    }
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}

    .mic-row{display:flex;align-items:center;gap:12px}
    .mic-chip{
      display:inline-flex;align-items:center;gap:8px;
      background:var(--card-2); border:1px solid var(--stroke); padding:10px 12px; border-radius:12px;
      font-weight:700
    }
    .select{
      appearance:none; width:100%; max-width:360px;
      padding:12px 42px 12px 14px; border-radius:12px; border:1px solid var(--stroke);
      background:linear-gradient(180deg,rgba(255,255,255,.10),rgba(255,255,255,.06));
      color:var(--text); font-weight:600;
      background-image:
        radial-gradient(circle at right 12px center, #ffffff 0 2px, transparent 3px),
        radial-gradient(circle at right 26px center, #ffffff 0 2px, transparent 3px);
      background-repeat:no-repeat;
    }
    .select:focus{outline:none;box-shadow:var(--ring)}

    .btn{
      border:0;border-radius:14px;padding:10px 14px;font-weight:800;letter-spacing:.2px;
      cursor:pointer; transition:.2s transform, .2s box-shadow, .2s opacity;
      color:#0f132f
    }
    .btn-primary{background:linear-gradient(90deg,#79a1ff,#9b79ff)}
    .btn-ghost{background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.05)); color:#e7eaff}
    .btn-danger{background:linear-gradient(90deg,#ff9670,#ff6b6b)}
    .btn:disabled{opacity:.6;cursor:not-allowed}
    .btn:not(:disabled):hover{transform:translateY(-1px);box-shadow:0 10px 24px rgba(0,0,0,.25)}

    .ctrl{padding:14px;border-radius:16px;background:var(--card-2);border:1px solid var(--stroke)}
    .ctrl h5{margin:0 0 8px 0;font-size:13px;color:#dfe6ff;letter-spacing:.25px}
    .ctrl .val{font-size:12.5px;color:#c8d1ff;opacity:.9}
    input[type="range"]{width:100%}
    input[type="range"]{
      -webkit-appearance:none;height:6px;border-radius:999px;background:rgba(255,255,255,.18);outline:none
    }
    input[type="range"]::-webkit-slider-thumb{
      -webkit-appearance:none;width:22px;height:22px;border-radius:999px;
      background:radial-gradient(circle at 30% 30%, #ffffff, #e6eaff 60%, #b8c3ff);
      border:2px solid #7a90ff99; box-shadow: 0 4px 18px #7b68ee88
    }
    input[type="range"]::-moz-range-thumb{
      width:22px;height:22px;border-radius:999px;border:2px solid #7a90ff99;background:#e6eaff;box-shadow: 0 4px 18px #7b68ee88
    }

    .status{
      text-align:center;padding:14px;border-radius:12px;
      background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.05));
      border:1px solid var(--stroke); color:#dbe3ff; font-weight:700
    }

    .viz{
      height:160px;border-radius:16px;border:1px solid var(--stroke);
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.04));
      position:relative; overflow:hidden
    }
    .wave{
      position:absolute;left:0;top:50%;width:100%;height:2px;background:#ff7f7f;transform:translateY(-50%);
      box-shadow:0 0 0 rgba(0,0,0,0)
    }
    .pulse{
      position:absolute;left:50%;top:50%;width:20px;height:20px;border-radius:999px;background:var(--accent);
      transform:translate(-50%,-50%); opacity:.9
    }
    @keyframes heartbeat{0%,100%{transform:translate(-50%,-50%) scale(1)}50%{transform:translate(-50%,-50%) scale(1.28)}}

    .bpm-block{
      text-align:center;margin-top:10px;display:flex;flex-direction:column;align-items:center;gap:4px;
    }
    #bpm-main{
      font-weight:900;font-size: clamp(22px, 4vw, 34px); letter-spacing:.3px;
      color:#ffce79;
    }
    #bpm-maternal{
      font-size:14px;color:#ffc4c4;opacity:.9;
    }

    .banner{
      margin-top:10px;border-radius:12px;padding:10px 12px;
      background:linear-gradient(180deg, rgba(255,107,107,.25), rgba(255,107,107,.16));
      border:1px solid #ff8080aa; color:#ffe9e9; font-size:13px
    }

    .tabpanel{display:none;margin-top:16px}
    .tabpanel.active{display:block}
    .prose h3{margin:0 0 10px 0}
    .prose ul{margin:6px 0 0 18px;color:#e7ebff}
    .prose li{margin:6px 0}
    .audio{display:none;text-align:center;margin-top:10px}
    .audio a{color:#e7ebff}

    @media (max-width: 920px){
      .tabs{max-width:100%}
      .grid-3{grid-template-columns: 1fr}
      .mic-row{flex-direction:column;align-items:flex-start}
      .subtitle{margin-left:0}
    }
  </style>
</head>
<body>
<div class="wrap">
  <!-- Header -->
  <div class="header">
    <div class="app-icon">üíó</div>
    <div>
      <h1 class="title">BabyBeat Monitor</h1>
    </div>
  </div>
  <div class="subtitle">Band-pass + compression with monitoring, recording, fetal & maternal BPM estimates.</div>

  <!-- Tabs -->
  <div class="tabs" role="tablist" aria-label="Modes">
    <button class="tab" role="tab" aria-selected="true" aria-controls="detector" id="tab-detector">Detector</button>
    <button class="tab" role="tab" aria-selected="false" aria-controls="instructions" id="tab-instructions">Instructions</button>
    <button class="tab" role="tab" aria-selected="false" aria-controls="positioning" id="tab-positioning">Positioning</button>
  </div>

  <!-- DETECTOR -->
  <section id="detector" class="tabpanel active" role="tabpanel" aria-labelledby="tab-detector">
    <div class="card stack" style="margin-top:16px">
      <!-- Mic selection -->
      <div class="mic-row">
        <span class="mic-chip">üîß Microphone:</span>
        <select id="micType" class="select">
          <option value="smartphone">Smartphone Built-in Mic</option>
          <option value="dji-mic-mini" selected>DJI Mic Mini</option>
          <option value="professional">Professional External Mic</option>
          <option value="stethoscope">Electronic Stethoscope</option>
          <option value="custom">Custom Settings</option>
        </select>
      </div>

      <!-- Buttons -->
      <div class="row">
        <button id="startBtn" class="btn btn-primary">‚ñ∂ Start Listening</button>
        <button id="stopBtn" class="btn btn-ghost" disabled>‚ñ† Stop</button>
        <button id="monitorBtn" class="btn btn-ghost" disabled>üéß Monitor: Off</button>
        <button id="playEnhancedBtn" class="btn btn-ghost" disabled>üîä Play Enhanced (short)</button>
        <button id="recBtn" class="btn btn-danger" disabled>‚è∫ Start Recording</button>
      </div>

      <!-- Controls -->
      <div class="grid-3">
        <div class="ctrl">
          <h5>Sensitivity</h5>
          <input type="range" id="sensitivity" min="1" max="10" value="7" />
          <div class="val"><span id="sensitivityValue">7</span></div>
        </div>
        <div class="ctrl">
          <h5>Filter Frequency</h5>
          <input type="range" id="filterFreq" min="10" max="400" value="60" />
          <div class="val"><span id="filterValue">60 Hz</span></div>
        </div>
        <div class="ctrl">
          <h5>Monitor Volume</h5>
          <input type="range" id="monitorVol" min="0" max="100" value="30" />
          <div class="val"><span id="monitorVolValue">30%</span></div>
        </div>
      </div>

      <!-- Status -->
      <div id="status" class="status">
        Select a microphone and click <b>Start Listening</b> (use HTTPS/localhost).
      </div>

      <!-- Visualization -->
      <div class="viz" aria-hidden="true">
        <div id="waveform" class="wave"></div>
        <div id="pulse" class="pulse"></div>
      </div>

      <!-- BPM -->
      <div class="bpm-block">
        <div id="bpm-main">-- BPM</div>
        <div id="bpm-maternal">Maternal: --</div>
      </div>

      <!-- Warning -->
      <div class="banner">For educational use only. This does not replace professional prenatal care.</div>

      <!-- Recording preview -->
      <div id="playbackArea" class="audio">
        <audio id="playbackAudio" controls></audio><br/>
        <a id="downloadLink" href="#" download="heartbeat.webm">Download recording</a>
      </div>
    </div>
  </section>

  <!-- INSTRUCTIONS -->
  <section id="instructions" class="tabpanel" role="tabpanel" aria-labelledby="tab-instructions">
    <div class="card prose" style="margin-top:16px">
      <h3>üéß Microphone Setup Guide</h3>
      <ul>
        <li><strong>Use headphones</strong> for live monitoring to avoid feedback/echo.</li>
        <li>Typical starting point: Filter <strong>50‚Äì80 Hz</strong>, Sensitivity <strong>6‚Äì9</strong>.</li>
        <li>Place the mic directly on skin and move slowly.</li>
      </ul>

      <h3>üîß Troubleshooting</h3>
      <ul>
        <li>Use HTTPS or localhost, then allow microphone permission.</li>
        <li>Reduce Sensitivity/Monitor Volume if you hear hiss or squeal.</li>
        <li>Big spikes or 180+ BPM likely mean noise; the detector smooths it.</li>
      </ul>

      <h3>‚ö†Ô∏è Medical Disclaimer</h3>
      <p>This app is for educational purposes only and should not replace professional prenatal monitoring or advice.</p>
    </div>
  </section>

  <!-- POSITIONING -->
  <section id="positioning" class="tabpanel" role="tabpanel" aria-labelledby="tab-positioning">
    <div class="card prose" style="margin-top:16px">
      <h3>üìç Optimal Microphone Positioning</h3>
      <ul>
        <li>18+ weeks: begin around/just below the belly button, sweep slowly.</li>
        <li>8‚Äì16 weeks: start lower, above the pubic bone, and sweep both sides.</li>
        <li>If concerned or unable to detect, contact your healthcare provider.</li>
      </ul>
    </div>
  </section>
</div>

<!-- App logic -->
<script type="module" src="./main.js"></script>
</body>
</html>
